# =============================================================================
# Atomic Build Workflow (DO NOT USE)
# =============================================================================
#
# This reusable workflow handles the build process.
# It is designed to be called by other workflows, executing:
#   - Frontend Build
#   - Electron Backend Build
#   - Artifact Upload (frontend-dist, electron-dist)
#
# =============================================================================

name: Build (DO NOT USE)

on:
    workflow_call:

# =============================================================================
# Permissions
# =============================================================================
# Restrict default GITHUB_TOKEN permissions (OpenSSF Scorecard best practice)
# Jobs declare their own permissions as needed
permissions: {}

env:
    NODE_VERSION: '20'
    CI: true

jobs:
    build:
        name: Build Application
        runs-on: ubuntu-latest
        permissions:
            contents: read

        steps:
            - name: Checkout Code
              uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v4

            - name: Setup Node.js
              uses: actions/setup-node@6044e13b5dc448c55e2357c09f80417699197238 # v4
              with:
                  node-version: ${{ env.NODE_VERSION }}
                  cache: 'npm'

            - name: Install Dependencies
              run: npm ci

            - name: Build Frontend
              run: npm run build
              env:
                  NODE_ENV: production

            - name: Build Electron Backend
              run: npm run build:electron

            # Upload build outputs for use by test and release workflows
            - name: Upload Frontend Build
              uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02 # v4
              with:
                  name: frontend-dist
                  path: dist/
                  retention-days: 1

            - name: Upload Electron Build
              uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02 # v4
              with:
                  name: electron-dist
                  path: dist-electron/
                  retention-days: 1
